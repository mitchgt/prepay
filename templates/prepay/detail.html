{% extends "prepay/base.html" %}

{% load url from future %}

{% block content %}

<h2>{{ listing.name }}</h2>

{% if listing %}
	<table width="100%" style="background-color:white; border-style: solid; border-width: 1px; border-color: #ccc; border-radius: 5px; font-size:14px;">
		<tr>
			<td valign="top" width="200">
				<img src="{{ listing.product.get_picture_url }}" width="200" style="border:none; padding-right:8px; padding-top:10px; padding-left:10px; float:left;">
			</td>
			<td style="padding:10px;font-size:14px;">
				{% if user.username = listing.product.seller.username %}
				{% if listing.status = "Open for bidding" or listing.status = "Maximum reached" or listing.status = "In Production" %}
					<form action = "{% url 'withdrawListing' listing.id %}" method = "get">
					{% csrf_token %}
					<input class = "button" type = "submit" value = "Withdraw listing"/>
					</form>
				{% endif %}
				{% if listing.status = "In Production" %}
					<form action = "" method = "post">
					{% csrf_token %}
					<input class = "button" type = "submit" name = "shipped" value = "Change status to 'Shipped'"/>
					</form>
				{% endif %}
				{% endif %}
				<b>Listing Description:</b> {{ listing.description }}<br/>
				<b>Product Description:</b> {{ listing.product.description }}<br/>
				<b>Seller:</b> <a href="{% url 'profile' listing.product.seller.username %}">{{ listing.product.seller.username }}</a> (rating = {{ listing.product.seller.rating }}/5)<br/>
				<b>Categories:</b> {% for c in listing.product.categories.all %} {{ c.name }}, {% endfor %}<br/>
				<b>Created Date:</b> {{listing.created_at}}<br/>
				<b>Price:</b> ${{listing.price}}<br/>
				{% if listing.status == 'Open for bidding' and isBuyer and not goalreached %}
				<form action = "{% url 'checkout' listing.id %}" method = "get">
				{% csrf_token %}
				<input class = "button" type = "submit" value = "Pre-order"/>
				</form>
				{% endif %}
				<b>Status:</b> {{listing.status}}<br/>
				<b>Minimum goal:</b> {{listing.minGoal}}<br/>
				<b>Maximum goal:</b> {{listing.maxGoal}}<br/>
				<b>Current number of bidders:</b> {{listing.numBidders}}<br/>
				{% if listing.product.seller.username = user.username %}
					<a href = "{% url 'orders' listing.id %}">View current orders</a><br/>
				{% endif %}
				<b>Deadline for bidding:</b> {{listing.deadlineBid}}<br/>
				<b>Deadline for delivery:</b> {{listing.deadlineDeliver}}<br/>
			</td>
		</tr>
	</table>	
	<h2>Comments</h2>
	{% if listing.listing_comment_set.all %}
		{% for co in listing.listing_comment_set.all %}
		<table width="100%" style="border-style: solid; border-width: 1px; border-color: #ccc; border-radius: 5px;">
			<tr>
				<td style="padding:10px;font-size:14px;">
					{{co.comment}}<br/>
					{% if co.image %}
						<img src="{{MEDIA_URL}}{{co.image}}" width="200" style="border:none;padding-top:5px;"><br/>
					{% endif %}	
				
				<br/><i>&mdash; {{co.commenter.username}}, {{co.date}}</i><br/>
				</td>

			</tr>
		</table>
		<br clear="all" />
		{% endfor %}
	{% else %}
		<p> No comments available. </p>
	{% endif %}

	{% if login_flag %}
	<p><b>Leave a comment!</b></p>
	<form enctype="multipart/form-data" action = "" method = "post">
		{% csrf_token %}
		{{form.as_p}}
		<input type = "submit" value = "Submit Comment">
	</form>
	{% else %}
		<a href="{% url 'index' %}">Login to comment!</a>
	{% endif %}

{% else %}
	hmm... we seem not to find that listing
{% endif %}


{% endblock %}

