{% extends "prepay/base.html" %}

{% load url from future %}

{% block content %}

<h2>Browse Listings</h2>

<form action="{% url 'browse_listings' %}search/" method="post">
		{% csrf_token %}
        {{form.as_table}}
        <input type="submit" value="Search">
 </form>

<form action="" method="get">
Sort by:
	<select name = 'sort' onChange = "this.form.submit();">
		<option value="" selected="selected">---------</option>
		<option value="1">Date posted</option>
		<option value="2">Seller</option>
		<option value="3">Price - lowest to highest</option>
		<option value="4">Price - highest to lowest</option>
		<option value="5">Status</option>
		<option value="6">Deadline for bidding</option>
	</select>
 </form>

{% if all_listings %}
	{% for listing in all_listings %}
	<table width="100%" style="border-style: solid; border-width: 1px; border-color: #ccc; border-radius: 5px;">
		<tr>
			<td width="150" valign="top" style="padding:10px;">
				<a href="{% url 'listing_detail' listing.pk %}">
					<img src="{{ listing.product.get_picture_url }}" width="150" align="left" style="border:none; padding-right:8px;"></a>
			</td>
			<td style="padding-top:10px;padding-bottom:10px;font-size:14px;">
				<a href="{% url 'listing_detail' listing.pk %}">{{ listing.name }}</a><br/>
				{{ listing.description|truncatewords:40 }}<br/>
				<b>Product:</b> {{ listing.product.name }}<br/>
				<b>Price:</b> ${{listing.price}}<br/>
				<b>Status:</b> {{listing.status}} <br/>
				<b>Seller:</b> <a href="{% url 'profile' listing.product.seller.username %}">{{listing.product.seller.username}}</a> (rating = {{ listing.product.seller.rating }}/5)<br/>
				<b>Categories:</b> 
				{% for c in listing.product.categories.all %} 
					<a href="{% url 'browse_category' c.pk %}">{{ c.name }}</a>, 
				{% endfor %}<br/>
				<a href="{% url 'listing_detail' listing.pk %}">Listing Detail</a>
			</td>
		</tr>
	</table>
	<br clear="all"/>
	{% endfor %}
{% else %}
	<p>No Listings are available.</p>
{% endif %}

{% endblock %}




